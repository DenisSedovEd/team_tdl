{% extends "task_app/base.html" %}

{% block title %}Список задач{% endblock %}

{% block content %}
<div class="mb-3">
  <a href="{% url 'task_create' %}" class="btn btn-primary">Создать задачу</a>
  {% if request.GET.completed == '1' %}
    <a href="{% url 'task_list' %}" class="btn btn-outline-secondary">Список активных задач</a>
  {% else %}
    <a href="{% url 'task_list' %}?completed=1" class="btn btn-secondary">Просмотреть завершённые</a>
  {% endif %}
</div>
<h1>Список задач {% if user.company%}{{ user.company }}{% endif %}</h1>
{% for task in task_list %}
<li class="list-group-item">
    <a href="{% url 'task_detail' task.id %}"><h3>{{ task.title }}</h3></a>
    {% if task.parent_task %}
    <h5>Главная задача: <a href="{% url 'task_detail' task.parent_task.id %}">{{ task.parent_task.title }}</a></h5>
    {% endif %}
    <p>Исполнитель: {{ task.user }}</p>
    <p>{{ task.description }}</p>
    <small>
        Статус: {{ task.status }} | Дата создания: {{ task.created_at }} | Последнее обновление: {{ task.updated_at }}
    </small>
    <br>
    <a href="{% url 'task_update' task.id %}" class="btn btn-primary">Изменить задачу</a>
    <form action="{% url 'task_completed' task.id %}" method="post">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">Завершить задачу</button>
    </form>
    <hr>
</li>
{% endfor %}
{% endblock %}